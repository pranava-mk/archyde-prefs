# Hyprland Configuration

## Overview
HyDE-based Hyprland setup with custom multi-monitor dimming configuration.

## Monitor Setup
- **DP-1**: External 2560x1440@60Hz (top, primary)
- **eDP-1**: Laptop 1920x1080@60Hz @ 1.2 scale (below, centered)

## Key Customizations

### Window Dimming (hyprdim)
Native Hyprland `dim_inactive` is disabled. Using **hyprdim** for temporary dimming on focus switch:
- Dims briefly when switching windows, then fades back
- Solo windows don't dim (hyprdim v3.x default)

**Autostart** (in `hyprland.conf`):
```conf
exec-once = hyprdim --strength 0.7 --duration 800
```

| Parameter | Value | Description |
|-----------|-------|-------------|
| strength | 0.7 | Dimming intensity (0.0-1.0) |
| duration | 800 | ms before removing dim |

### Borders/Gaps
Disabled in `userprefs.conf`:
```conf
general {
    gaps_in = 0
    gaps_out = 0
    border_size = 0
}
```

### Clipboard Manager (cliphist)
Using **cliphist** - native Wayland clipboard manager with rofi integration.

**Features**:
- Text and image support
- Wayland-native (wl-clipboard)
- Rofi integration for quick access
- Stores binary data

**Autostart** (in `hyprland.conf`):
```conf
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
```

**Keybindings** (in `keybindings.conf`):
```conf
Super + V → Open clipboard history (short preview)
Super + Shift + V → Open full clipboard manager
```

**Note**: clipse was tested but removed (TUI took too much space, limited image preview support)

## File Structure
| File | Purpose |
|------|---------|
| `hyprland.conf` | Main config, sources other files |
| `userprefs.conf` | Personal preferences (persists across theme changes) |
| `monitors.conf` | Monitor layout configuration |
| `themes/theme.conf` | HyDE theme settings |
| `keybindings.conf` | Keyboard shortcuts |
| `windowrules.conf` | Window rules (Hyprland 0.53+ syntax) |
| `.history/` | Version-tracked configuration changes |

### Window Rules (Hyprland 0.53+)

**IMPORTANT**: Hyprland 0.53 completely rewrote window rule syntax.

**Modern syntax format**:
```conf
windowrule = <property> <value>, match:<type> <pattern>
```

**Key changes from old syntax**:
- ✅ All matchers use `match:` prefix (`match:class`, `match:title`)
- ✅ Boolean properties need explicit values (`float true`, `pin true`)
- ✅ `idle_inhibit fullscreen true` (replaces old `idleinhibit`)
- ✅ Layer rules use `match:namespace` prefix
- ❌ `initialTitle` removed (use `match:title` instead)
- ❌ `keepaspectratio` removed
- ❌ `windowrulev2` deprecated (use `windowrule`)

**Examples**:
```conf
# Float windows
windowrule = float true, match:class ^(vlc)$

# Set opacity (active, inactive, fullscreen)
windowrule = opacity 0.90 $& 0.90 $& 1, match:class ^(firefox)$

# Idle inhibit for media players
windowrule = idle_inhibit fullscreen true, match:class ^(.*mpv.*)$

# Layer rules
layerrule = blur true, match:namespace rofi
```

**Full documentation**: `~/Documents/system-issues-fixes/2026-02-13_hyprland-windowrules-syntax-v053.md`

## Documentation
| File | Purpose |
|------|---------|
| `CLAUDE.md` | Quick reference (this file) |
| `.history/CHANGELOG.md` | Change history with versions |
| `.history/PREFERENCES.md` | Detailed personal preferences |

## Git Tracking
This directory is git-tracked for version control.

```bash
# View changes
git status
git diff

# Commit changes
git add -A && git commit -m "Description of changes"

# View history
git log --oneline
```

## Adjusting Dimming
Edit `hyprland.conf` and change `--strength` value:
- `0.3` - Subtle
- `0.5` - Moderate
- `0.7` - Strong **current**
- `1.0` - Maximum

Then restart hyprdim:
```bash
pkill hyprdim && hyprdim --strength 0.7 --duration 800 &
```

## Wallpaper (Multi-Monitor)
If DP-1 shows black after connecting, reapply wallpaper:
```bash
~/.local/lib/hyde/wallpaper.sh --start --backend swww --global
```

## Waybar (Status Bar)

**Service**: `hyde-Hyprland-bar.service` (systemd user service)
**Config**: `~/.config/waybar/config.jsonc`

### Important Notes
- **Don't start waybar manually** - causes duplicate bars
- **Managed by systemd** - use systemctl to control it
- **Auto-generated by HyDE** - theme changes may overwrite customizations

### Personal Layout (Restored from Dec 18 backup)

Right side split into **3 separate pill groups**:

1. **`group/pill#right`** - General modules
   - `backlight` - Screen brightness
   - `pulseaudio` - Volume control
   - `pulseaudio#microphone` - Mic control
   - `battery` - Battery status

2. **`group/pill#tray`** - System tray (isolated)
   - `tray` - System tray icons

3. **`group/pill#menu`** - Menu items
   - Menu buttons and controls

### Config Backups

HyDE automatically backs up configs when switching themes:
```bash
# List backups (sorted by date)
ls -lt ~/.config/cfg_backups/*/\.config/waybar/config.jsonc

# Restore a specific backup
cp ~/.config/cfg_backups/251218_02h13m21s/.config/waybar/config.jsonc ~/.config/waybar/
systemctl --user restart hyde-Hyprland-bar.service
```

**Personal config backup**: `~/.config/cfg_backups/251218_02h13m21s/` (Dec 18, 2025)

### Common Operations

```bash
# Restart waybar
systemctl --user restart hyde-Hyprland-bar.service

# Check waybar status
systemctl --user status hyde-Hyprland-bar.service

# View waybar logs
journalctl --user -u hyde-Hyprland-bar.service -f
```

---

## Quick Reference

| Issue | Command |
|-------|---------|
| DP-1 black wallpaper | `~/.local/lib/hyde/wallpaper.sh --start --backend swww --global` |
| Duplicate waybars | `systemctl --user restart hyde-Hyprland-bar.service` |
| Restart dimming | `pkill hyprdim && hyprdim --strength 0.7 --duration 800 &` |
| Restart clipboard daemons | `pkill wl-paste && wl-paste --type text --watch cliphist store & wl-paste --type image --watch cliphist store &` |
| Reload Hyprland | `hyprctl reload` |
| Restore waybar config | `cp ~/.config/cfg_backups/251218_02h13m21s/.config/waybar/config.jsonc ~/.config/waybar/ && systemctl --user restart hyde-Hyprland-bar.service` |
| Check window rule errors | `hyprctl reload 2>&1 \| grep -i error` |
